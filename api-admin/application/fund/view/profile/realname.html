{extend name="../../index/view/public/layout" /}
{block name="style"}
<link rel="stylesheet" href="__STATIC__/member/css/member.css">
<link rel="stylesheet" href="__STATIC__/member/css/realname.css">
<link rel="stylesheet" href="__STATIC__/libs/webuploader/webuploader.css">
<link rel="stylesheet" href="__STATIC__/libs/magnific-popup/magnific-popup.css">
{/block}
{block name="main-container"}
<div class="member-container wrapper clearfix">
    {include file="public/left" /}

    <div class="member-main">
        <div class="member-main-title clearfix">
            <h3> 个人资料 > 实名认证 </h3>
        </div>
        <div class="warn-box">
            真实姓名和身份证号码一经认证不予修改，如确认修改，请联系客服！ <br>
            客服热线： <span class="text-red">{$telephone}</span> （客服时间： {$service_time} ）
        </div>
        <form action="" class="form form-realname" enctype="multipart/form-data" id="j-realname">
            <div class="control-group">
                <label for="">真实姓名</label>
                <div class="con">
                    <input type="text" name="name" {if condition="($is_verified eq 1)or($is_verified2 eq 1)" } disabled
                           {/if} class="realname" id="realname" value="{$info['name']}">
                </div>
            </div>
            <div class="control-group">
                <label for="">身份证号码</label>
                <div class="con">
                    <input type="text" name="id_card" {if condition="($is_verified eq 1)or($is_verified2 eq 1)" }
                           disabled {/if} class="idcard" id="idcard" value="{$info['id_card']}">
                </div>
            </div>


            <div class="control-group">
                <label for=""></label>
                <div class="con">
                    <input type="submit" class="btn btn-primary btn-red btn-submit" {if condition="$is_verified eq 1" }
                           disabled value="已实名认证" {else/} {if condition="$is_verified2 eq 1"} disabled value="认证中"
                    {else/} value="确认添加"{/if} {/if}/>
                </div>
            </div>
        </form>
    </div>
</div>
{/block}


{block name="script"}
<script src="__STATIC__/libs/layer/layer.js"></script>
<script src="__STATIC__/libs/webuploader/webuploader.min.js"></script>
<script src="__STATIC__/libs/magnific-popup/magnific-popup.min.js"></script>
<script src="__STATIC__/libs/jquery-validation/jquery.validate.js"></script>
<script src="__STATIC__/libs/jquery-validation/jquery.validate.messages_zh.js"></script>
<script src="__STATIC__/member/js/ajax_file_upload.js" type="text/javascript"></script>
<script src="__STATIC__/member/js/uploadImage.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        $(".user-portrait").hover(function () {
            $(this).children('p').show();
            $(this).addClass('edit-portrait');

        }, function () {
            $(this).children('p').hide();
            $(this).removeClass('edit-portrait');

        })


    })
</script>
<script>
    (function ($) {
        // 身份证校验
        $.validator.addMethod("identify", function (value, element) {
            var tel = /(^\d{15}$)|(^\d{17}([0-9]|X)$)/;
            return this.optional(element) || (tel.test(value));
        }, "身份证号码填写有误");


        $("#j-realname").validate({
            rules: {
                name: {
                    required: true,
                    minlength: 2
                },
                id_card: {
                    required: true,
                    identify: true
                },
            },

            messages: {
                name: {
                    required: "请输入您的姓名",
                    minlength: "姓名输入有误"
                },
                id_card: {
                    required: "请输入身份证号码"
                }
            },
            submitHandler: function (form) {
                // form.submit();
                var $this = $(this);
                $.ajax({
                    url: "{:url('realname')}",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: $("#realname").val(),
                        id_card: $("#idcard").val(),


                    },
                    success: function (data) {
                        if (data) {
                            layer.msg(data.msg, function () {
                                location.reload();
                            })
                        }

                    }
                })
            },
            errorElement: "span",
        })

    })(jQuery)
</script>

<script type="text/javascript">
    function imgUpload1(event) {
        var fileid = $(event).attr("id");
        var data = {'type': 'realnameimg1'};
        uploadFile(fileid, data, function (res) {
            if (res.code) {
                $("#imglogo1").attr("src", "/uploads/images/" + res.data);
                $("#imglogo1").show();
                $("#logo1").val(res.data);
                showTip(res.message, "success");
            } else {
                showTip(res.message, "error");
            }
        });
    }

    function imgUpload3(event) {
        var fileid = $(event).attr("id");
        var data = {'type': 'realnameimg3'};
        uploadFile(fileid, data, function (res) {
            if (res.code) {
                $("#imglogo3").attr("src", "/uploads/images/" + res.data);
                $("#imglogo3").show();
                $("#logo3").val(res.data);
                showTip(res.message, "success");
            } else {
                showTip(res.message, "error");
            }
        });
    }

    function imgUpload2(event) {

        var fileid = $(event).attr("id");
        var data = {'type': 'realnameimg2'};
        uploadFile(fileid, data, function (res) {
            if (res.code) {
                $("#imglogo2").attr("src", "/uploads/images/" + res.data);
                $("#imglogo2").show();
                $("#logo2").val(res.data);
                showTip(res.message, "success");
            } else {
                showTip(res.message, "error");
            }
        });
    }

    var urls = "{:url('member/profile/upload')}";


</script>
{/block}
